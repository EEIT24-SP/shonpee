<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<title>購物車</title>
<!--購物車样式表-->
<link rel="stylesheet" type="text/css" th:href="@{/css/cart.css}" />
<!--操作cookie的js文件-->
<script type="text/javascript" th:src="@{/js/jquery-3.4.1.js}"></script>
<script type="text/javascript" th:src="@{/js/cookie.js}"></script>
<link rel="stylesheet" th:href="@{/css/Bear_Shop.css}">
</head>

<body style="background-color: rgb(235, 235, 235);">
<div th:insert="model/cartheader::cartheader"></div>	
	<div class="cart-mid" id="cart-mid-id">
				<div class="cart-mid" id="cart-page-product-header">
			<div>
				<div class="cart-page-product-header__product">商品</div>
				<div class="cart-page-product-header__unit-price">單價</div>
				<div class="cart-page-product-header__quantity">數量</div>
				<div class="cart-page-product-header__total-price">總計</div>
				<div class="cart-page-product-header__action">操作</div>
			</div>
		</div>		
	<form action=""  th:action="@{/main-page/cart}"  method="post">		
		<div class="cart-page-shop-section" style="margin-top: 20px;" th:each="userto,iterStat : ${cartitem}">
		 <input th:name="|cartId|" th:value="${userto.cartId}" class="Cart_id" readonly="readonly" type="hidden"> 
			<div class="cart-page-shop-header">
				<div>
					<input  class="cart-page-checkbox">
					<div>
						<img src="../pic/store.svg" class="cart-page-shop-header-icon">
						 <input th:name="|memberId|" th:value="${userto.ProductBean.MemberBean.UserAccount}" readonly="readonly"> 						 
					</div>
				</div>
			</div>
				<div class="cart-page-product">
					<div class="cart-page-product-allitems">
						<div>
							<input type="checkbox" class="cart-page-checkbox" name="CKBX" value="97"> 
						<div>	<img 
                     th:name="|cartPhoto|" th:src="${userto.cartPhoto}"
								alt="" class="product-img">
								</div>
							<div class="product-description-box">
								<div>
								<input type="text"  th:name="|productBean.productName|" th:value="${userto.productBean.productName}">
								</div>
							</div>
							<div class="product-size">
								<div class="product-size-button" >
									規格
									<div class="product-size-button-icon"></div>
								</div>
								<div >
								<input class="typevalue1" th:value="${userto.typeValue1}" readonly="readonly">
								<input class="typevalue2" th:value="${userto.typeValue2}" readonly="readonly">
								</div>
							</div>
							<div class="product-unit-price">
							<input type="text" class="unit-price"  th:name="|productBean.productPrice|" 
							th:value="${userto.productBean.productPrice}" readonly="readonly" >
							</div>
							<div class="product-quanftity">
								<div>
									<button class="minus"  type="button">-</button>
							<input type="text"  class="numcount"  th:value="${userto.Quantity}"  value="1" readonly="readonly">
									<button  class="plus"  type="button">+</button>
								</div>
								<div>剩下10000件</div>
							</div>
							<div class="product-total-price-box">
								<input readonly="readonly" class="product-total-price" type="text"  th:value="${userto.TotalPrice}">
							</div>
							<div class="product-action">
								<button type="submit"  name="delete" class="product-action-delet" value="GG">刪除</button>
								<button class="product-action-like">
									<div>找相似<img src="../pic/triangle.svg" alt=""></div>
								</button>
							</div>
						</div>
					</div>
				</div>
		</div>
	</div>
	<div id="cart-page-flex-fixed-footer">
		<div id="cart-page-flex-fixed-footer-thredroll">
			<div id="cart-page-flex-fixed-footer-thredroll-settleaccounts">
				<button  id="cart-checkout-type" disabled="disabled" name="checkout"  value="checkout">去買單</button>
				<div>
					<div id="cart-page-flex-fixed-footer-thredroll-settleaccounts-total">
						<div id="cart-page-flex-fixed-footer-thredroll-settleaccounts-total-price" class="totals">$0</div>
						<div>總金額<span class="txts"></span>個商品:</div>
					</div>
				</div>
			</div>
		</div>
	</div>

</form>





	<br>
	<br>
	<hr class="main-page-container-hr" />
	<br>
	<br>

	
    <div th:insert="model/footer::footer"></div>





	<!--操作购物车页面的cart.js-->
	<script type="text/javascript" th:inline="javascript">
	$('.cart-page-checkboxTotal').on('click',function(){
		if($('.cart-page-checkbox').prop('checked')==false){
		$('.cart-page-checkbox').prop('checked','checked');
		}else{
			$('.cart-page-checkbox').prop('checked','');
		}
	});
	
	$(function(){
		$('.cart-page-checkbox').prop("checked","");
		$('.product-action-delet').prop('disabled','disabled');
	});

	$('.cart-page-checkbox').on('click',function(){
        var CKBXChecked = $(this).prop("checked");
    	console.log($('.cart-page-checkbox').length);
        if(CKBXChecked == true){
		var Cid =  $(this).parents().children('.Cart_id').val();
		$(this).parents().children().children('.product-action-delet').removeAttr('disabled')
		$(this).prop('value',Cid);
		$(this).parents().children('.product-total-price-box').children('.product-total-price').prop('name','totalPrice');
		$(this).parents().children('.product-quanftity').children('div').children('.numcount').prop('name','Quantity');
		$(this).parents().children('.product-size').children('div').children('.typevalue1').prop('name','typeValue1');
		$(this).parents().children('.product-size').children('div').children('.typevalue2').prop('name','typeValue2');
        }else if(CKBXChecked == false){
        	$(this).parents().children().children('.product-action-delet').prop('disabled','disabled')
    		$(this).removeAttr('value');
    		$(this).parents().children('.product-total-price-box').children('.product-total-price').removeAttr('name');
    		$(this).parents().children('.product-quanftity').children('div').children('.numcount').removeAttr('name');
    		$(this).parents().children('.product-size').children('div').children('.typevalue1').removeAttr('name');
    		$(this).parents().children('.product-size').children('div').children('.typevalue2').removeAttr('name');
        }
		
	
	});
	
	$('.product-action-delet').on('click',function(){		
			var Cid =  $(this).parents().children('.Cart_id').val();
			$(this).prop('value',Cid);
	});

	$('.plus').on('click', function () {
			var temp = $(this).parent().children('.numcount').prop('value');
			var total = $(this).parents().children('.product-total-price-box').children('.product-total-price').val();
			$(this).parents().children('.numcount').prop('value', parseInt(temp) + 1);
			var price = $(this).parents().children('.product-unit-price').children('.unit-price').val();
			$(this).parents().children('.product-total-price-box').children('.product-total-price').prop('value', (parseInt(total) + parseInt(price)));
            var isChecked = $(this).parents().children('.cart-page-checkbox').prop("checked");
            if(isChecked == true){
            	var plustotal =parseInt($(".totals").text());
    			var Ptotal = plustotal+parseInt(price);
    			$(".totals").text(Ptotal)
            }
			
			
		});
		$('.minus').on('click', function () {
			var temp = $(this).parent().children('.numcount').val();
			var total = $(this).parents().children('.product-total-price-box').children('.product-total-price').val();
			var price = $(this).parents().children('.product-unit-price').children('.unit-price').val();
			if (temp > 1) {
				$(this).parents().children('.numcount').prop('value', parseInt(temp) - 1);
				$(this).parents().children('.product-total-price-box').children('.product-total-price').prop('value', (parseInt(total) - parseInt(price)));
				  var isChecked = $(this).parents().children('.cart-page-checkbox').prop("checked");
		            if(isChecked == true){
				var minustotal =parseInt($(".totals").text());
				var Mtotal = minustotal-parseInt(price);
				$(".totals").text(Mtotal)
				}
			}
			// var total = $(this).parents().children('.product-total-price-box').children('.product-total-price').prop('value');

		});
	</script>
<!-- 	<#-- 計算總價 S --> -->
<script>
    $(function() {
        // 載入完頁面時,計算總計
        showTotal();
        console.log( showTotal());
        $('.cart-page-checkbox').on('click', function () {
            // 選擇多選框後,再重新計算
            showTotal();
        });

    });

    // 計算總計
    function showTotal() {

        var  total = 0;
        var  number = 0;
        // 1. 獲取所有的被勾選的條目複選框！迴圈遍歷
        $(".cart-page-checkbox").each(function () {
            var isChecked = $(this).prop("checked");
            // 如果多選框被選中
            if(isChecked == true) {
                // 2. 獲取複選框的值，即其他元素的字首
                var id = parseInt( $(this).parents().children('.product-total-price-box').children('.product-total-price').val());
                // alert("id" + id);
                //3. 再通過字首找到小計元素，獲取其文字
                var text = $("#" + id + "Subtotal").text();
                // alert(text);
                //4. 累加計算
                total += Number(id);
                number += 1;
                // alert(total);
            }
            if(number!=0){
            	$('#cart-checkout-type').removeAttr('disabled');}
            else{$('#cart-checkout-type').prop('disabled','disabled');}
        });
        // 5. 把總計顯示在總計元素上
        $(".txts").text(number);//toFixed(2)函式的作用是把total保留2位
        $(".totals").text(total);
    }
</script>
		
</body>

</html>